<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8">
  <title>Moje rezerwacje</title>
</head>
<body>
  <h1>ğŸ“… Moje rezerwacje</h1>
  <ul id="reservationList"></ul>

  <script>
    async function loadReservations() {
      const token = localStorage.getItem('token');

      if (!token) {
        alert('Brak tokena â€“ najpierw siÄ™ zaloguj!');
        window.location.href = 'loginpage.html';
        return;
      }

      try {
        const response = await fetch('http://localhost:8000/api/reservations', {
          headers: {
            'Authorization': 'Bearer ' + token
          }
        });

        if (!response.ok) throw new Error("BÅ‚Ä…d " + response.status);

        const data = await response.json();
        const list = document.getElementById('reservationList');
        list.innerHTML = '';

        data.member.forEach(reservation => {
          const li = document.createElement('li');
          li.innerHTML = `
            Pojazd: ${reservation.vehicle.brand} ${reservation.vehicle.model} (${reservation.vehicle.licensePlate}) |
            Od: ${reservation.startTime} |
            Do: ${reservation.endTime} |
            Status: ${reservation.status}
          `;

          if (reservation.status !== 'cancelled') {
            const cancelBtn = document.createElement('button');
            cancelBtn.textContent = 'Anuluj';
            cancelBtn.onclick = () => cancelReservation(reservation.id);
            li.appendChild(cancelBtn);
          }

          list.appendChild(li);
        });
      } catch (error) {
        console.error('BÅ‚Ä…d pobierania rezerwacji:', error);
        document.getElementById("reservationList").innerHTML =
          "<li>âŒ Nie udaÅ‚o siÄ™ pobraÄ‡ rezerwacji. Czy jesteÅ› zalogowany?</li>";
      }
    }

    async function cancelReservation(id) {
      const token = localStorage.getItem('token');
      const confirmed = confirm('Czy na pewno chcesz anulowaÄ‡ tÄ™ rezerwacjÄ™?');

      if (!confirmed) return;

      try {
        const response = await fetch(`http://localhost:8000/api/reservations/${id}/cancel`, {
          method: 'POST',
          headers: {
            'Authorization': 'Bearer ' + token,
            'Content-Type': 'application/json'
          }
        });

        if (response.ok) {
          alert('Rezerwacja anulowana.');
          loadReservations(); // odÅ›wieÅ¼ listÄ™
        } else {
          alert('Nie udaÅ‚o siÄ™ anulowaÄ‡ rezerwacji.');
        }
      } catch (error) {
        console.error('BÅ‚Ä…d anulowania:', error);
        alert('BÅ‚Ä…d poÅ‚Ä…czenia z serwerem.');
      }
    }

    loadReservations();
  </script>
</body>
</html>
